#!/bin/bash

main() {
  load_config
  local main_cmd="nex $1 $2 $3"
  local fn_1=fn_$1
  local script_1=$1'_'$2.sh
  local script_2=$1.sh
  local cmd_1=_nx_$1'_'$2
  local cmd_2=_nx_$1
  if [ "$(type -t $fn_1)" == function ]; then
    $fn_1 ${@:2}
    return 0
  fi

  if [ -z "$1" ]; then
    fn_hello
    return 1
  fi

  if is_script "$script_1"; then
    run_script $script_1 "${@:3}"
  elif is_script "$script_2"; then
    run_script $script_2 "${@:2}"
  elif is_cmd $cmd_1; then
    $cmd_1 "${@:3}"
  elif is_cmd $cmd_2; then
    $cmd_2 "${@:2}"
  else
    echo " not_found: $main_cmd"
  fi
}

is_cmd() {
  if command -v $1 &> /dev/null; then
    return 0
  else
    return 1
  fi
}

is_script() {
  if [[ -f "$(nex_cli_path)/src/$1" ]]; then
    return 0
  else
    return 1
  fi
}

run_script() {
  bash $(nex_cli_path)/src/$1 ${@:2}
}

load_config() {
  eval $(fn__config)
}

fn_hello() {
  echo " Hello Nex CLI !"
  echo " Usage: nex <1> <2> <3>"
  echo
}

fn__plugin_path() {
  echo $nex_plugin_base/$1.plugin
}

fn__config() {
  cat <<EOF
export nex_root_path=$HOME/dotfiles
export nex_cli_path=$nex_root_path/cli.nex
export nex_plugin_base=$nex_root_path/plugins
export nex_mod_base=$nex_root_path/mods
EOF
}

main "$@"
